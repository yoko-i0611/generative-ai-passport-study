# 問い合わせフォームのセキュリティリスクと対策

## 現在の実装のリスク

### 1. **スパム送信の悪用**
- **リスク**: 悪意のあるユーザーが大量のメールを送信
- **影響**: Gmailアカウントが制限されたり、停止される可能性
- **Gmailの制限**: 1日あたり約500通の送信制限

### 2. **Gmailアカウントの停止リスク**
- **リスク**: 大量送信により、Googleがスパム送信者と判定
- **影響**: Gmailアカウントが一時的または永続的に停止される可能性
- **リピュテーション問題**: ドメインやIPアドレスの評価が下がる

### 3. **レート制限の欠如**
- **リスク**: 同一IPアドレスやメールアドレスからの連続送信
- **影響**: サーバーリソースの消費、API制限への抵触

### 4. **ボットによる自動送信**
- **リスク**: プログラムによる自動的な大量送信
- **影響**: サーバー負荷の増大、正当なユーザーへの影響

### 5. **メールアドレスの検証不備**
- **リスク**: 不正なメールアドレスの使用、なりすまし
- **影響**: 偽のメールアドレスからの送信、トラッキングの困難

### 6. **入力内容の検証不足**
- **リスク**: 悪意のあるコンテンツの送信（XSS、インジェクション攻撃）
- **影響**: セキュリティホールの作成

## 推奨される対策

### 優先度: 高

1. **レート制限（Rate Limiting）**
   - IPアドレス単位での送信頻度制限（例: 1時間に3回まで）
   - メールアドレス単位での送信頻度制限

2. **CAPTCHA の実装**
   - Google reCAPTCHA v3 または v2 の導入
   - ボットによる自動送信の防止

3. **入力検証の強化**
   - メールアドレスの形式検証
   - メッセージ長の制限（例: 最大2000文字）
   - HTMLタグのサニタイズ

### 優先度: 中

4. **送信頻度の制限**
   - 1日あたりの送信回数の制限
   - サーバーサイドでのセッション管理

5. **ログ記録と監視**
   - 送信ログの記録
   - 異常な送信パターンの検出

6. **エラーメッセージの最適化**
   - 詳細なエラー情報の非表示（情報漏洩の防止）

### 優先度: 低

7. **メール送信サービスの検討**
   - SendGrid、Mailgun などの専用サービスの利用
   - Gmailアカウントへの負担を軽減

8. **ホワイトリスト/ブラックリスト**
   - 特定のメールアドレスやドメインの許可/拒否

## 現在の実装の状態

✅ **実装済み**
- 基本的なバリデーション（必須項目チェック）
- エラーハンドリング

❌ **未実装（推奨）**
- レート制限
- CAPTCHA
- メールアドレスの詳細検証
- メッセージ長の制限
- 送信ログ

## 緊急度別の対策提案

### 即座に実装すべき（高リスク）
1. レート制限の実装（IPアドレス単位、1時間に3回まで）
2. メッセージ長の制限（2000文字まで）
3. メールアドレスの形式検証

### 近日中に実装すべき（中リスク）
4. CAPTCHA の導入（reCAPTCHA v3推奨）
5. 送信ログの記録
6. エラーメッセージの最適化

### 将来的に検討（低リスク）
7. メール送信サービスの移行（SendGrid等）
8. ホワイトリスト/ブラックリスト機能

