# 分析機能改修前の状態への復元計画

**作成日**: 2025-01-03  
**目的**: 分析機能改修前の状態（教材とデザインが良くアップデートできた状態）に戻す

---

## 📋 現在の状況

### 問題点
1. **分析機能の改修中にエラーが発生**
   - `Module not found: Can't resolve '@/lib/questions'`エラー
   - 発生箇所: `app/analytics/page.tsx:5:1`

2. **TOPページのデザインが大きく変わってしまった**
   - 現在の`app/page.tsx`: 15KB（簡略化された状態）
   - バックアップの`app.backup_before_git_restore/page.tsx`: 21KB（完全な状態）

### 確認済みのバックアップ
- ✅ `app.backup_before_git_restore/page.tsx` - Git復元前のバックアップ（21KB）
- ✅ `app/page.tsx.before_restore` - 復元前のバックアップ（21KB）
- ✅ `app/page.tsx.current_backup` - 現在のバックアップ（9KB）
- ✅ `analytics_backup/` - 分析機能のバックアップ

---

## 🎯 復元したい状態

### 分析機能改修前の状態（教材とデザインが良くアップデートできた状態）

**特徴**:
- ✅ 完全なTOPページのデザイン（21KB）
- ✅ 学習進捗表示セクション
- ✅ コース一覧セクション
- ✅ 機能紹介セクション
- ✅ 教材の内容が充実している
- ✅ ユニットごとの教材が整備されている

**ファイルサイズの比較**:
- 現在: `app/page.tsx` = 15KB（簡略化）
- 復元したい状態: `app.backup_before_git_restore/page.tsx` = 21KB（完全版）

---

## 📊 経緯の把握

### Git履歴から分かること

**最新のコミット**:
1. `6449751` - feat: Recreate homepage design layout for OG image
2. `c0714e0` - fix: Simplify OG image to center layout to resolve display flex errors
3. `ad26bbb` - Add learning history preservation with confirmation dialogs and improved UI
4. `767f422` - Fix quiz page: API-based loading, restore Vercel UI, add home button

**現在の変更状況**:
- `app/page.tsx` - 変更済み（簡略化された状態）
- `app/layout.tsx` - 変更済み
- `app/quiz/page.tsx` - 変更済み
- 多くのファイルが削除されている

### バックアップファイルから分かること

1. **`app.backup_before_git_restore/page.tsx`**
   - Git復元前の状態（21KB）
   - 完全なデザインと機能が含まれている
   - 学習進捗表示、コース一覧などが実装されている

2. **`analytics_backup/`**
   - 分析機能のバックアップ
   - 300問の問題データ
   - ユニット情報
   - 型定義、ユーティリティ、フック

---

## 🔄 復元手順

### ステップ1: 現在の状態をバックアップ

```bash
cd /Users/imamurayoko/Desktop/Cursor/application
# 現在の状態をバックアップ
cp app/page.tsx app/page.tsx.current_error_state
cp app/layout.tsx app/layout.tsx.current_error_state
```

### ステップ2: TOPページを復元

```bash
# 分析機能改修前の状態に復元
cp app.backup_before_git_restore/page.tsx app/page.tsx
# または
cp app/page.tsx.before_restore app/page.tsx
```

### ステップ3: その他のファイルを確認・復元

```bash
# layout.tsxを確認
diff app.backup_before_git_restore/layout.tsx app/layout.tsx

# 必要に応じて復元
cp app.backup_before_git_restore/layout.tsx app/layout.tsx
```

### ステップ4: 動作確認

```bash
# 開発サーバーを起動
npm run dev

# ブラウザで確認
# http://localhost:3000/
```

### ステップ5: 分析機能の改修（エラーが起きないように）

**注意**: 分析機能の改修は、TOPページが正常に動作することを確認してから開始

1. **データファイルの復元**
   ```bash
   cp analytics_backup/app_questions_300.json public/
   cp analytics_backup/units_info.json public/
   ```

2. **型定義の復元**
   ```bash
   mkdir -p app/types
   cp analytics_backup/types/question.ts app/types/
   cp analytics_backup/types/answer.ts app/types/
   ```

3. **ユーティリティの復元**
   ```bash
   mkdir -p app/lib
   cp analytics_backup/lib/questions.ts app/lib/
   cp analytics_backup/lib/calculateStats.ts app/lib/
   cp analytics_backup/lib/units.ts app/lib/
   ```

4. **フックの復元**
   ```bash
   mkdir -p app/hooks
   cp analytics_backup/hooks/useAnswerTracking.ts app/hooks/
   ```

5. **分析ページの確認・統合**
   - 既存の`app/analytics/page.tsx`とバックアップ版を比較
   - エラーが起きないようにインポートパスを修正

---

## ⚠️ 重要な注意事項

### 1. 復元の順序
1. **まずTOPページを復元**（分析機能改修前の状態）
2. **動作確認**（TOPページが正常に表示されることを確認）
3. **分析機能を改修**（エラーが起きないように慎重に）

### 2. インポートパスの修正
バックアップのファイルは以下のパスを使用している可能性があります：
- `@/lib/questions` → `@/app/lib/questions`
- `@/types/question` → `@/app/types/question`
- `@/hooks/useAnswerTracking` → `@/app/hooks/useAnswerTracking`

### 3. Next.js App Routerの構造
- `app/`ディレクトリ配下に配置
- `public/`ディレクトリにJSONファイルを配置

### 4. 既存ファイルとの競合
- 既に`app/analytics/page.tsx`が存在するため、統合が必要
- 既存の型定義（`types/index.ts`）と統合する必要がある可能性

---

## 📁 復元に必要なファイル一覧

### TOPページの復元
- [ ] `app/page.tsx` - `app.backup_before_git_restore/page.tsx`から復元
- [ ] `app/layout.tsx` - 必要に応じて復元
- [ ] `app/globals.css` - 必要に応じて復元

### 分析機能の改修（エラーが起きないように）
- [ ] `public/app_questions_300.json` - 300問の問題データ
- [ ] `public/units_info.json` - ユニット情報
- [ ] `app/types/question.ts` - 問題の型定義
- [ ] `app/types/answer.ts` - 回答の型定義
- [ ] `app/lib/questions.ts` - 問題データ読み込み
- [ ] `app/lib/calculateStats.ts` - 統計計算
- [ ] `app/lib/units.ts` - ユニット情報管理
- [ ] `app/hooks/useAnswerTracking.ts` - 回答追跡フック
- [ ] `app/analytics/page.tsx` - 分析ページ（既存版と統合）

---

## 🔍 エラーが起きないようにするための対策

### 1. インポートパスの統一
- すべてのインポートパスを`@/app/...`形式に統一
- `tsconfig.json`のパスエイリアス設定を確認

### 2. 型定義の統合
- 既存の`types/index.ts`と新しい型定義を統合
- 重複を避ける

### 3. 段階的な実装
- 一度にすべてを実装せず、段階的に追加
- 各ステップで動作確認

### 4. エラーハンドリング
- 各関数に適切なエラーハンドリングを追加
- データが存在しない場合の処理を追加

---

## 📝 チェックリスト

### 復元前の確認
- [ ] 現在の状態をバックアップ
- [ ] Gitの状態を確認（`git status`）
- [ ] 復元するファイルを特定

### TOPページの復元
- [ ] `app/page.tsx`を復元
- [ ] `app/layout.tsx`を確認・復元
- [ ] 動作確認（TOPページが正常に表示される）

### 分析機能の改修
- [ ] データファイルを復元
- [ ] 型定義を復元
- [ ] ユーティリティを復元
- [ ] フックを復元
- [ ] 分析ページを統合
- [ ] インポートパスを修正
- [ ] 動作確認（エラーが発生しない）

---

## 🚀 推奨される作業順序

1. **現在の状態をバックアップ**
2. **TOPページを復元**（`app.backup_before_git_restore/page.tsx`から）
3. **動作確認**（TOPページが正常に表示されることを確認）
4. **分析機能の改修を開始**（エラーが起きないように慎重に）
5. **段階的に実装**（各ステップで動作確認）
6. **最終確認**（すべての機能が正常に動作することを確認）

---

## 📚 参考資料

### バックアップの場所
- `app.backup_before_git_restore/`: `/Users/imamurayoko/Desktop/Cursor/application/app.backup_before_git_restore/`
- `analytics_backup/`: `/Users/imamurayoko/Desktop/Cursor/application/analytics_backup/`

### 関連ドキュメント
- `GIT_RESTORE_HANDOVER.md` - Git復元作業の引き継ぎ書
- `analytics_page_troubleshooting_handover.md` - Analyticsページのトラブルシューティング
- `復元したい状態の把握と整理.md` - 復元したい状態の詳細

---

**最終更新**: 2025-01-03  
**次の作業**: TOPページの復元から開始


