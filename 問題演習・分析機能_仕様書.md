# 問題演習・分析機能 仕様書

**作成日**: 2025-01-04  
**目的**: 問題演習と分析機能の構造・ルールを専門家に評価してもらうための仕様書  
**対象**: 生成AIパスポート試験対策アプリケーション

---

## 📋 目次

1. [概要](#概要)
2. [問題演習機能の仕様](#問題演習機能の仕様)
3. [分析機能の仕様](#分析機能の仕様)
4. [データ構造とアルゴリズム](#データ構造とアルゴリズム)
5. [学習理論との関係](#学習理論との関係)
6. [評価観点](#評価観点)

---

## 1. 概要

### 1.1 システムの目的

本システムは、生成AIパスポート試験（60分60問）の対策を目的とした学習プラットフォームです。問題演習機能と分析機能により、効果的な試験対策を支援します。

### 1.2 対象ユーザー

- 生成AIパスポート試験の受験者
- 体系的に知識を習得したい学習者
- 自分の学習進捗を可視化したい学習者

### 1.3 主要機能

1. **問題演習機能**: 300問の問題データベースから、指定した問題数でランダムに出題
2. **分析機能**: 学習履歴を蓄積・分析し、弱点分野の特定と推奨学習領域の提示

---

## 2. 問題演習機能の仕様

### 2.1 問題データベース

**データソース**: `public/app_questions_300.json`（300問）

**問題構成**:
- 第1章 AI（人工知能）: 75問
- 第2章 生成AI: 53問
- 第3章 情報リテラシー: 49問
- 第4章 プロンプト制作: 61問
- 第5章 実践と応用: 60問

**問題形式**: 単一選択式（複数選択にも対応可能な設計）

### 2.2 問題数選択オプション

ユーザーは以下の6つのオプションから選択できます：

| 問題数 | 想定時間 | 説明 |
|--------|----------|------|
| 10問 | 約5分 | 短時間でサクッと復習 |
| 20問 | 約10分 | 標準的な演習時間 |
| 30問 | 約30分 | じっくりと学習 |
| 50問 | 約50分 | 模擬試験レベル |
| 100問 | 約100分 | 全問題制覇・完全マスター |
| 300問 | 約300分 | 全問題制覇・完全マスター |

**設計思想**: 
- 10-30問: 隙間時間での学習を想定
- 50問: 本番試験に近い形式（60問の試験に対して50問で練習）
- 100-300問: 徹底的な復習・習熟を想定

### 2.3 問題の出題アルゴリズム

#### 2.3.1 シャッフルアルゴリズム

**使用アルゴリズム**: Fisher-Yates shuffle（フィッシャー–イェーツのシャッフル）

```typescript
const shuffleArray = <T,>(array: T[]): T[] => {
  const shuffled = [...array];
  for (let i = shuffled.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
  }
  return shuffled;
};
```

**特徴**:
- 完全ランダムな並び替えを保証
- 各順列が等確率で生成される
- 重複の問題は発生しない（選択した問題数が総問題数以下の場合）

#### 2.3.2 出題ルール

1. **全問題プールから選択**: 300問すべてから指定数だけランダムに選択
2. **重複なし**: 同一セッション内では同じ問題は出題されない
3. **毎回異なる順序**: セッションごとに異なる順序で出題

**設計思想**: 
- 問題の偏りを防ぐため、全問題プールから均等に選択
- 記憶の順序効果を減らすため、毎回ランダムな順序

### 2.4 解答時間の計測

#### 2.4.1 計測方法

**計測単位**: 秒（整数値）

**計測タイミング**:
1. 問題表示時刻: 問題が画面に表示された時点（`useEffect`で自動記録）
2. 解答時刻: ユーザーが回答を選択して「回答する」ボタンを押した時点
3. 解答時間: `解答時刻 - 問題表示時刻`

**データ保存**:
- 各問題の解答時間を`questionTimes`オブジェクトに記録
  ```typescript
  questionTimes: { [questionId: string]: number } // 秒単位
  ```

#### 2.4.2 異常値の処理

- **最小値**: 0秒以下は記録しない
- **最大値**: 300秒（5分）を超える解答は統計から除外
- **理由**: 離席や中断による異常値を除外し、有効なデータのみで統計を計算

#### 2.4.3 平均時間の計算

**優先順位**:
1. **実際の解答時間から計算**: `questionTimes`が記録されている場合
   ```
   平均時間 = Σ(各問題の解答時間) / 問題数
   ```
2. **フォールバック**: `questionTimes`がない場合はセッション時間から計算
   ```
   平均時間 = セッション時間 / 問題数
   ```

**目標値**: 60秒/問（試験本番: 60分60問 = 60秒/問）

### 2.5 セッション管理

#### 2.5.1 セッションの開始

**開始タイミング**:
- 問題数を選択して「演習開始」ボタンを押した時点
- 復習モードを開始した時点

**保存データ**:
- `sessionStartTime`: セッション開始時刻（ミリ秒）
- `questionStartTimes`: 各問題の表示時刻（ミリ秒）

#### 2.5.2 セッションの継続（履歴保存・復元）

**保存タイミング**:
- 各問題に回答した後
- 次の問題に進んだ時点
- ページを離れる時点（`beforeunload`イベント）

**保存データ** (`localStorage`の`quizHistory`):
```typescript
{
  answers: { [questionId: string]: string },  // 問題ID: 回答
  correctAnswers: number,                      // 正解数
  totalQuestions: number,                      // 総問題数
  currentQuestionIndex: number,                // 現在の問題番号
  completed: boolean,                          // 完了フラグ
  timestamp: number,                           // タイムスタンプ
  isReviewMode: boolean,                       // 復習モードか
  selectedQuestionCount: number                // 選択した問題数
}
```

**復元条件**:
- 24時間以内の履歴のみ有効
- 未完了（`completed: false`）の履歴のみ
- 同じ問題数（`selectedQuestionCount`）の履歴のみ

**復元時の動作**:
- 回答済みの問題と回答内容を復元
- 現在の問題番号から再開
- 新しいセッション開始時刻を設定（時間計測は継続）

#### 2.5.3 セッションの終了

**完了時**:
- すべての問題に回答した時点
- セッション結果を`ComprehensiveLearningHistory`に保存

**途中終了時**:
- 「TOPに戻る」ボタンを押した時点
- 確認ダイアログで「OK」を選択した場合
- 回答済みの問題のみをセッションとして保存

**保存データ** (`QuizSession`):
```typescript
{
  id: string,                                  // セッションID
  timestamp: number,                           // タイムスタンプ
  answers: { [questionId: string]: string },   // 問題ID: 回答
  correctAnswers: number,                      // 正解数
  totalQuestions: number,                      // 回答した問題数（途中終了の場合は回答済み数）
  accuracy: number,                            // 正答率（%）
  duration: number,                            // セッション時間（秒）
  selectedQuestionCount: number,               // 選択した問題数
  isReviewMode: boolean,                       // 復習モードか
  questionTimes?: { [questionId: string]: number } // 各問題の解答時間（秒）
}
```

### 2.6 復習モード

#### 2.6.1 復習モードの開始

**条件**: 通常モードで間違えた問題が1問以上ある場合

**動作**:
- 間違えた問題のみを抽出
- 新しいセッションとして開始
- `isReviewMode: true`として記録

#### 2.6.2 復習モードの特徴

- 間違えた問題のみを出題
- 通常モードとは別のセッションとして記録
- 統計情報には含まれるが、章別進捗には影響（通常モードと同様に記録）

---

## 3. 分析機能の仕様

### 3.1 学習履歴の管理

#### 3.1.1 データ保存場所

**保存場所**: ブラウザの`localStorage`

**キー名**: `comprehensiveLearningHistory`

**データ構造**: `ComprehensiveLearningHistory`型

```typescript
{
  sessions: QuizSession[],                    // 全セッション履歴
  totalSessions: number,                      // 総セッション数
  totalQuestionsAnswered: number,             // 総回答数
  totalCorrectAnswers: number,                // 総正解数
  overallAccuracy: number,                    // 全体正答率（%）
  averageSessionDuration: number,             // 平均セッション時間（秒）
  averageTimePerQuestion: number,             // 1問あたりの平均時間（秒）
  lastSessionDate: number,                    // 最終セッション日時
  chapterProgress: {                          // 章別進捗
    [chapter: string]: {
      totalAnswered: number,                  // 回答数
      totalCorrect: number,                   // 正解数
      accuracy: number,                       // 正答率（%）
      lastAttempted: number                   // 最終回答日時
    }
  },
  skillProgress: {                            // スキル別進捗
    [skillCategory: string]: {
      totalAnswered: number,
      totalCorrect: number,
      accuracy: number,
      chapter: string,
      lastAttempted: number
    }
  },
  weakAreas: string[],                        // 弱点領域（章IDの配列）
  strongAreas: string[],                      // 得意領域（章IDの配列）
  weakSkills: string[],                       // 弱いスキル（スキル名の配列）
  strongSkills: string[],                     // 強いスキル（スキル名の配列）
  learningTrend: 'improving' | 'stable' | 'declining', // 学習傾向
  recommendedFocus: string[]                  // 推奨学習領域（章IDの配列、最大3つ）
}
```

### 3.2 統計情報の計算

#### 3.2.1 全体統計

**総回答数**: 全セッションの`totalQuestions`の合計

**総正解数**: 全セッションの`correctAnswers`の合計

**全体正答率**:
```
全体正答率 = (総正解数 / 総回答数) × 100
```

**平均セッション時間**:
- 有効なセッションのみを対象（`duration > 0 && duration <= 7200`秒 = 2時間以内）
- 異常値（2時間超、0秒以下、NaN）は除外
```
平均セッション時間 = Σ(有効なセッション時間) / 有効なセッション数
```

**1問あたりの平均時間**:
- 優先: `questionTimes`が記録されている場合は実際の解答時間から計算
- フォールバック: セッション時間から計算
- 異常値除外: 5分（300秒）を超える解答は除外
```
1問あたりの平均時間 = Σ(有効な解答時間) / 有効な解答数
```

#### 3.2.2 章別進捗

**対象章**: `chapter1`, `chapter2`, `chapter3`, `chapter4`, `chapter5`

**章の特定方法**: 問題文から章を推測（問題データの`chapter`フィールドを使用）

**計算方法**:
1. 各問題の章を特定
2. 章ごとに回答数と正解数を集計
3. 正答率を計算: `(正解数 / 回答数) × 100`

**更新タイミング**: セッション追加時に自動更新

#### 3.2.3 スキル別進捗

**スキルカテゴリの特定**: 問題データの`skillCategory`フィールド（`metadata.tags[0]`）

**計算方法**:
1. 各問題のスキルカテゴリを特定
2. スキルごとに回答数と正解数を集計
3. 正答率を計算: `(正解数 / 回答数) × 100`

**最小回答数**: 2問以上で分析対象

### 3.3 弱点・得意領域の特定

#### 3.3.1 弱点領域（weakAreas）

**判定条件**:
- 正答率が60%未満
- 回答数が3問以上
- 有効な章（`chapter1`-`chapter5`）のみ

**設計思想**: 
- 60%は試験合格ラインを想定（本番試験では正答率が重要）
- 3問以上で統計的有意性を確保

#### 3.3.2 得意領域（strongAreas）

**判定条件**:
- 正答率が80%以上
- 回答数が3問以上
- 有効な章（`chapter1`-`chapter5`）のみ

**設計思想**: 
- 80%以上で「得意」と判定（試験対策として十分な習熟度）
- 弱点領域と同様に、3問以上で統計的有意性を確保

### 3.4 推奨学習領域の算出

#### 3.4.1 アルゴリズム

**優先順位**:

1. **苦手領域を最優先**（`weakAreas`の上位3つ）
   - 正答率60%未満の章
   - 試験対策として最も効果的

2. **未学習の章**（苦手領域が3つ未満の場合）
   - 回答数が5問未満の章
   - 基礎章（`chapter1`）を優先

3. **中程度の理解度の章**（苦手領域が3つ未満の場合）
   - 正答率60-79%の章
   - 継続学習が効果的
   - 正答率が低い順に優先

4. **フォールバック**（全く学習していない場合）
   - `chapter1`, `chapter2`, `chapter3`を順番に推奨

**最大推奨数**: 3つまで

#### 3.4.2 設計思想

- **試験対策の効率化**: 苦手領域を優先的に学習することで、総合的な正答率向上を目指す
- **継続学習の促進**: 中程度の理解度の章も推奨し、学習の継続を支援
- **基礎の重視**: 未学習の場合や基礎章が弱い場合は、基礎章を優先

### 3.5 学習傾向の分析

#### 3.5.1 傾向の判定

**対象**: 直近3回のセッション

**判定方法**:
1. 直近3回のセッションの正答率を取得
2. 正答率の推移を分析

**判定基準**:
- **向上中（improving）**: 最新のセッションが最も正答率が高い
- **低下中（declining）**: 最新のセッションが最も正答率が低い
- **安定（stable）**: 上記以外（変動が少ない、またはデータ不足）

#### 3.5.2 設計思想

- **モチベーション向上**: 学習の進捗を可視化
- **早期発見**: 成績の低下を早期に発見し、学習方法の見直しを促す

### 3.6 表示コンポーネント

#### 3.6.1 トップページ（`/`）

**表示内容**:
- 全体正答率
- 総回答数
- 推奨学習領域（最大3つ）
- 1問あたりの平均時間

#### 3.6.2 学習分析ページ（`/analytics`）

**表示内容**:
- **統計サマリー**:
  - 総セッション数
  - 総回答数
  - 全体正答率
  - 1問あたりの平均時間（目標: 60秒/問）
  - 学習傾向（向上中/安定/低下中）
- **章別進捗分析**:
  - 各章の正答率
  - 回答数
  - 進捗バー表示
- **得意領域**:
  - 正答率80%以上の章
  - 章名と正答率を表示
- **推奨学習領域**:
  - 苦手領域を優先した推奨領域（最大3つ）
  - 章名とリンクを表示
- **最近のセッション**:
  - 直近10回のセッション履歴
  - 日時、問題数、正答率、時間を表示

---

## 4. データ構造とアルゴリズム

### 4.1 問題データ構造

```typescript
type Question = {
  id: number;                              // 問題ID（1から開始）
  question: string;                        // 問題文
  options: string[];                       // 選択肢の配列
  correctAnswer: string | string[];        // 正解（単一選択または複数選択）
  explanation: string;                     // 解説
  chapter?: string;                        // 章（例: "第1章 AI（人工知能）"）
  difficulty?: 'easy' | 'medium' | 'hard'; // 難易度
  skillCategory?: string;                  // スキルカテゴリ
}
```

### 4.2 セッションデータ構造

```typescript
type QuizSession = {
  id: string;                              // セッションID（UUID）
  timestamp: number;                       // タイムスタンプ（ミリ秒）
  answers: { [questionId: string]: string }; // 問題ID: 回答
  correctAnswers: number;                  // 正解数
  totalQuestions: number;                  // 回答した問題数
  accuracy: number;                        // 正答率（%）
  duration: number;                        // セッション時間（秒）
  selectedQuestionCount: number;           // 選択した問題数
  isReviewMode: boolean;                   // 復習モードか
  questionTimes?: { [questionId: string]: number }; // 各問題の解答時間（秒）
}
```

### 4.3 シャッフルアルゴリズムの詳細

**Fisher-Yates shuffle**:

- **時間計算量**: O(n)
- **空間計算量**: O(n)
- **特性**: 各順列が等確率で生成される

**実装**:
```typescript
const shuffleArray = <T,>(array: T[]): T[] => {
  const shuffled = [...array];  // 元の配列をコピー
  for (let i = shuffled.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));  // 0からiまでの乱数
    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];  // 交換
  }
  return shuffled;
};
```

### 4.4 推奨学習領域のアルゴリズム詳細

```typescript
function updateRecommendations(history: ComprehensiveLearningHistory): void {
  const validChapters = ['chapter1', 'chapter2', 'chapter3', 'chapter4', 'chapter5'];
  
  // 1. 苦手領域を特定（正答率60%未満、回答数3問以上）
  const weakAreas = Object.entries(history.chapterProgress)
    .filter(([chapter, progress]) => 
      validChapters.includes(chapter) && 
      progress.accuracy < 60 && 
      progress.totalAnswered >= 3
    )
    .map(([chapter, _]) => chapter);
  
  // 2. 得意領域を特定（正答率80%以上、回答数3問以上）
  const strongAreas = Object.entries(history.chapterProgress)
    .filter(([chapter, progress]) => 
      validChapters.includes(chapter) && 
      progress.accuracy >= 80 && 
      progress.totalAnswered >= 3
    )
    .map(([chapter, _]) => chapter);
  
  // 3. 推奨領域を決定
  const recommendations: string[] = [];
  
  // 3-1. 苦手領域を最優先（最大3つ）
  recommendations.push(...weakAreas.slice(0, 3));
  
  // 3-2. 未学習の章を追加（苦手領域が3つ未満の場合）
  if (recommendations.length < 3) {
    const unstudiedChapters = validChapters.filter(chapter => {
      const progress = history.chapterProgress[chapter];
      return !progress || progress.totalAnswered < 5;
    });
    recommendations.push(...unstudiedChapters.slice(0, 3 - recommendations.length));
  }
  
  // 3-3. 中程度の理解度の章を追加（苦手領域が3つ未満の場合）
  if (recommendations.length < 3) {
    const moderateChapters = Object.entries(history.chapterProgress)
      .filter(([chapter, progress]) => 
        validChapters.includes(chapter) &&
        progress.accuracy >= 60 &&
        progress.accuracy < 80 &&
        progress.totalAnswered >= 3 &&
        !weakAreas.includes(chapter)
      )
      .sort(([,a], [,b]) => a.accuracy - b.accuracy)  // 正答率が低い順
      .map(([chapter, _]) => chapter);
    recommendations.push(...moderateChapters.slice(0, 3 - recommendations.length));
  }
  
  // 3-4. フォールバック（全く学習していない場合）
  if (recommendations.length === 0) {
    recommendations.push('chapter1', 'chapter2', 'chapter3');
  }
  
  history.recommendedFocus = recommendations.slice(0, 3);
}
```

---

## 5. 学習理論との関係

### 5.1 間隔反復学習（Spaced Repetition）

**実装**: 
- 復習モードで間違えた問題を再度出題
- 章別進捗により、苦手な章を繰り返し学習

**効果**: 
- 記憶の定着を促進
- 忘却曲線に基づいた学習を支援

### 5.2 適応的学習（Adaptive Learning）

**実装**: 
- 推奨学習領域の算出
- 弱点領域の特定と優先的な学習推奨

**効果**: 
- 個人の習熟度に応じた学習パスを提供
- 効率的な学習時間の活用

### 5.3 メタ認知の促進

**実装**: 
- 学習分析ページで進捗を可視化
- 1問あたりの平均時間による時間管理の支援
- 学習傾向の分析による自己評価の支援

**効果**: 
- 自分の学習状況を客観的に把握
- 学習計画の見直しと改善

### 5.4 テスト効果（Testing Effect）

**実装**: 
- 問題演習による知識の再確認
- 即座のフィードバック（正誤判定と解説）

**効果**: 
- 受動的な学習（読むだけ）よりも能動的な学習（問題を解く）の方が記憶定着が良い

### 5.5 目標設定理論

**実装**: 
- 1問あたりの平均時間の目標値（60秒/問）
- 正答率による習熟度の可視化

**効果**: 
- 具体的な目標を設定することで学習意欲を向上
- 進捗の可視化による達成感の向上

---

## 6. 評価観点

### 6.1 技術的な観点

#### 6.1.1 データの整合性
- **確認事項**: セッション履歴と統計情報の整合性
- **評価ポイント**: 
  - 総回答数 = 全セッションの`totalQuestions`の合計か
  - 章別進捗 = 全セッションの回答を正しく集計しているか

#### 6.1.2 パフォーマンス
- **確認事項**: 300問のデータ処理、大量のセッション履歴の処理
- **評価ポイント**: 
  - 問題の取得速度
  - 統計情報の計算速度
  - ブラウザの`localStorage`の容量制限（通常5-10MB）

#### 6.1.3 エラーハンドリング
- **確認事項**: 異常値の処理、データの欠損
- **評価ポイント**: 
  - 異常な解答時間の除外
  - データの欠損時のフォールバック処理

### 6.2 教育効果の観点

#### 6.2.1 学習効率
- **確認事項**: 推奨学習領域の算出ロジックの妥当性
- **評価ポイント**: 
  - 苦手領域の優先が適切か
  - 未学習領域の扱いが適切か

#### 6.2.2 モチベーション維持
- **確認事項**: 学習傾向の分析、進捗の可視化
- **評価ポイント**: 
  - 学習者のモチベーション向上に寄与するか
  - フィードバックが適切なタイミングで提供されるか

#### 6.2.3 試験対策の効果
- **確認事項**: 問題の出題方法、時間管理の支援
- **評価ポイント**: 
  - 本番試験の形式に近いか
  - 時間管理の訓練に適しているか

### 6.3 ユーザビリティの観点

#### 6.3.1 操作性
- **確認事項**: 問題演習の流れ、分析ページの見やすさ
- **評価ポイント**: 
  - 直感的に操作できるか
  - 情報が適切に整理されているか

#### 6.3.2 フィードバック
- **確認事項**: 正誤判定、解説、分析結果の提示
- **評価ポイント**: 
  - 即座のフィードバックが提供されるか
  - 分析結果が理解しやすいか

### 6.4 改善提案の観点

以下の点について、専門家の意見を求めます：

1. **問題の出題方法**: 完全ランダム vs 適応的出題（苦手領域を多く出題）
2. **推奨学習領域の算出**: 現在のロジックの妥当性
3. **統計情報の計算**: 異常値の除外基準の妥当性
4. **学習傾向の分析**: 直近3回のセッションで十分か
5. **復習モード**: 間違えた問題のみの復習が効果的か

---

## 7. 今後の拡張可能性

### 7.1 ユニット別の進捗分析

現在は章別の進捗のみを分析していますが、より細かいユニット単位での分析が可能です。

### 7.2 適応的出題

現在は完全ランダムですが、苦手領域を多く出題する適応的出題機能の追加が可能です。

### 7.3 学習計画の提案

推奨学習領域に基づいて、具体的な学習計画（例: 「第1章を10問ずつ3回学習」）を提案することが可能です。

### 7.4 ソーシャル機能

他の学習者との比較や、学習時間のランキングなどのソーシャル機能の追加が可能です。

---

## 8. 用語集

- **セッション**: 1回の問題演習（問題数選択から完了まで）
- **復習モード**: 間違えた問題のみを再度出題するモード
- **章別進捗**: 各章（第1章-第5章）ごとの学習進捗
- **スキル別進捗**: より細かいスキルカテゴリごとの学習進捗
- **弱点領域**: 正答率が60%未満の章
- **得意領域**: 正答率が80%以上の章
- **推奨学習領域**: システムが推奨する学習すべき領域（最大3つ）
- **学習傾向**: 直近3回のセッションの正答率の推移（向上中/安定/低下中）

---

**最終更新**: 2025-01-04  
**作成者**: AI Assistant  
**レビュー対象**: 問題演習・分析機能の構造・ルール

