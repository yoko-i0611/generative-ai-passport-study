# ローカルストレージのデータ管理について

## 現在の実装状況

### 保存されているデータ

1. **購入状態** (`platform_purchase_status`)
   - 保存場所: localStorage
   - 有効期限: なし（無期限）
   - 削除条件: ユーザーが手動で削除するまで保持

2. **学習履歴** (`comprehensiveLearningHistory`)
   - 保存場所: localStorage
   - 有効期限: なし（無期限）
   - 削除条件: ユーザーが手動で削除するまで保持

3. **問題演習履歴** (`quizHistory`)
   - 保存場所: localStorage
   - 有効期限: なし（無期限）
   - 削除条件: ユーザーが手動で削除するまで保持

### 注意: コード内の「24時間以内の履歴が有効です」について

`app/components/LearningProgress.tsx`に「24時間以内の履歴が有効です」という表示がありますが、これは**表示用のメッセージのみ**で、実際の削除処理は実装されていません。

**実際の動作**:
- 学習履歴は無期限に保存される
- 24時間経過しても自動削除されない
- ユーザーが手動で削除するまで保持される

---

## localStorageが削除される場合

### 意図的に削除しない場合でも削除されるケース

1. **ブラウザの設定で「閲覧履歴を削除」を実行**
   - ブラウザの設定 → プライバシー → 閲覧履歴データの削除
   - 「Cookie および他のサイトデータ」を選択して削除

2. **ブラウザのストレージ容量が上限に達した場合**
   - ブラウザが自動的に古いデータを削除
   - 上限はブラウザによって異なる（通常5-10MB程度）

3. **プライベートモード/シークレットモードで終了**
   - プライベートモードで使用した場合、タブを閉じるとデータが削除される

4. **ブラウザの再インストール**
   - ブラウザをアンインストールして再インストールすると、すべてのデータが削除される

5. **OSの再インストール**
   - OSを再インストールすると、すべてのデータが削除される

6. **ブラウザのバグやクラッシュ**
   - まれにブラウザのバグやクラッシュによりデータが失われる場合がある

7. **ウイルス対策ソフトやクリーンアップツール**
   - 一部のウイルス対策ソフトやクリーンアップツールがlocalStorageを削除する場合がある

---

## 規約・プライバシーポリシーへの記載案

### プライバシーポリシーへの追加（推奨）

**第3条（個人情報の管理）に追加**:

```markdown
### 学習履歴の保存について

本アプリの学習履歴（問題演習の結果、進捗情報など）は、利用者のブラウザのローカルストレージに保存されます。

**重要な注意事項**:
- 学習履歴は、利用しているブラウザ・端末ごとに独立して保存されます
- 別のブラウザや端末では、学習履歴は共有されません
- ブラウザの設定で「閲覧履歴データの削除」を実行すると、学習履歴も削除されます
- ブラウザの再インストール、OSの再インストール、プライベートモードの使用などにより、学習履歴が失われる場合があります
- 学習履歴が失われた場合、当方では復元できません

**データの保存期間**:
- 学習履歴は、ユーザーが手動で削除するまで、または上記の理由により削除されるまで保存されます
- 当方では、学習履歴の保存期間を保証するものではありません
```

### 利用規約への追加（推奨）

**第5条（保証の否認および免責）に追加**:

```markdown
### データの保存について

本アプリの学習履歴は、利用者のブラウザのローカルストレージに保存されます。
以下の場合、学習履歴が失われる可能性があります：

- ブラウザの設定で閲覧履歴データを削除した場合
- ブラウザの再インストール
- OSの再インストール
- プライベートモード/シークレットモードの使用
- ブラウザのストレージ容量が上限に達した場合
- その他、ブラウザや端末の設定によりデータが削除される場合

学習履歴が失われた場合、当方は一切の責任を負いません。
```

---

## 実装の推奨事項

### 1. コード内の「24時間以内の履歴が有効です」の修正

`app/components/LearningProgress.tsx`の表示を修正：

```typescript
// 修正前
<p>• 24時間以内の履歴が有効です</p>

// 修正後
<p>• 学習履歴はこのブラウザに保存されます</p>
<p>• ブラウザの設定で削除されない限り、無期限に保存されます</p>
```

### 2. 規約・プライバシーポリシーへの記載

上記の記載案を追加することを推奨します。

---

## まとめ

### 現在の実装

- **保存期間**: 無期限（ユーザーが手動で削除するまで）
- **自動削除**: なし（24時間の自動削除は実装されていない）
- **端末間の共有**: なし（各ブラウザ/端末で独立）

### 削除される場合

1. ユーザーが手動で削除
2. ブラウザの設定で閲覧履歴を削除
3. ブラウザのストレージ容量が上限に達した場合
4. プライベートモード/シークレットモードで終了
5. ブラウザの再インストール
6. OSの再インストール
7. その他のブラウザや端末の設定

### 規約への記載

**推奨**: プライバシーポリシーと利用規約の両方に記載することを推奨します。

